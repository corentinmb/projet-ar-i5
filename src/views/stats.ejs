<html>

<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	 crossorigin="anonymous"></script>
	<script>
    var ioStats = io.connect();
	ioStats.on('rafraichirStats', function(data){
		console.log(data)
		if (data.length != 0){
			setTimeout(function(){ genererListeJoueurs(data,'#joueurs') }, 1000);
		}
		else{
			var message = "Pas de joueurs actuellement";
			afficherNoJoueurs(message, '#joueurs')
		}
	});

	var countDownDate;
	ioStats.on('timer', function(data){
		countDownDate = data;
	});

	// Update the count down every 1 second
	var x = setInterval(function() {

		// Get todays date and time
		var now = new Date().getTime();
		
		// Find the distance between now an the count down date
		var distance = countDownDate - now;
		
		// Time calculations for days, hours, minutes and seconds
		var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
		var seconds = Math.floor((distance % (1000 * 60)) / 1000);
		
		// Output the result in an element with id="demo"
		if(countDownDate == undefined){
			document.getElementById("timer").innerHTML = "En attente du lancement de la partie...";
		}
		else{
			document.getElementById("timer").innerHTML = minutes + "m " + seconds + "s ";
		}
		// If the count down is over, write some text 
		if (distance < 0) {
			clearInterval(x);
			document.getElementById("timer").innerHTML = "Fin de la partie !";
		}
	}, 1000);

	function genererListeJoueurs(d, input){
		var array = d;
		var newHTML = [];
		$.each(array, function(index, value) {
			newHTML.push('<span>' + value.nom + '</span>');
			newHTML.push('<img src="avatars/avatar-'+value.id+'.png" alt="Avatar" height="42" width="42">')
		});
		$(input).html(newHTML.join("<br>"));
	}

	function afficherNoJoueurs(message, input){
			var newHTML = [];
			newHTML.push('<span>' + message + '</span>');
			$(input).html(newHTML.join("<br>"));
	}

	</script>
</head>

<body>
	<div id="joueurs"></div>
	<p id="timer"></p>
	
	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	 crossorigin="anonymous"></script>
</body>

</html>